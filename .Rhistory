y = '',
x = 'Years',
subtitle = paste0('n = ', nrow(eo.top10))
) +
theme(plot.subtitle=element_text(size=9, hjust=0, face="italic", color="black")) +
theme_bw() +
theme(legend.position = "none")
plot.top10.time
### Save new dataframe ###
fwrite(data, './data/executive_orders_withcountry.csv')
library(here)
library(readtext)
library(quanteda)
library(stringr)
library(dplyr)
library(newsmap)
library(sentimentr)
library(data.table)
library(tidyr)
library(maps)
library(countrycode)
library(ggplot2)
# Setup----
#===================#
rm(list=ls())
# set wd to where the source file is
# make sure you have the datafiles in a /data/ folder
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
data <- fread('./data/executive_orders_withcountry.csv')
library(syuzhet)
library(tidyverse)
library(lubridate)
library(plotly)
library(tibble)
data[,"sentiment_syuzhet"]<-NA
data$sentiment_syuzhet <- get_sentiment(data$text)
fig_sentiment <- ggplot(data %>% filter(date > "1950-04-11"),aes(x=date,y=sentiment_syuzhet, color = sentiment_syuzhet)) + geom_point() +
geom_smooth(aes(x=date,y=sentiment_syuzhet),method=lm, se=FALSE)
fig_sentiment
fig_sentiment_China <- ggplot(data %>% filter(country == "China"),aes(x=date,y=sentiment_syuzhet, color = sentiment_syuzhet)) + geom_point() +
geom_smooth(aes(x=date,y=sentiment_syuzhet),method=lm, se=FALSE)
fig_sentiment_China
fig_Obama <- ggplot(data %>% filter(president == "Barack Obama"),aes(x=date,y=sentiment_syuzhet, color = sentiment_syuzhet)) + geom_point() +
geom_smooth(aes(x=date,y=sentiment_syuzhet),method=lm, se=FALSE)
fig_Obama
sentiment_df<-sentiment_by(text.var = data$text,
polarity_dt = lexicon::hash_sentiment_jockers_rinker,
n.before = 5,
n.after = 2)
glimpse(sentiment_df)
summary(sentiment_df$ave_sentiment)
data <- cbind(data,sentiment_df$ave_sentiment)
data <-data %>% rename(sentiment_valence = V2)
fig_3 <- ggplot(data %>% filter(president == "Barack Obama"),aes(x=date,y=sentiment_valence, color = sentiment_valence)) + geom_point() +
geom_smooth(aes(x=date,y=sentiment_valence),method=lm, se=FALSE)
fig_3
rm(sentiment_df)
library(quanteda.textmodels)
library(quanteda.textplots)
library(quanteda.dictionaries)
library(quanteda.corpora)
library(quanteda.tidy)
sentiment_corpus <- corpus(data,
docid_field =  "eo_number",
text_field = 'text')
head(summary(sentiment_corpus))
sentiment_corpus_tokens <- tokens(sentiment_corpus,
remove_punct = TRUE,
remove_numbers = TRUE,
remove_symbols = TRUE) %>%
tokens_tolower() %>%
tokens_remove(stopwords("english"))
collocations <- sentiment_corpus_tokens %>%
textstat_collocations(min_count = 250,
size = 2) %>%
filter(count >250)
sentiment_corpus_tokens <- tokens_compound(sentiment_corpus_tokens,
phrase(collocations$collocation))
sentiment_corpus_dfm<-dfm(sentiment_corpus_tokens)
sentiment_corpus_dfm_AFINN <- sentiment_corpus_dfm %>%
dfm(.,
dictionary = data_dictionary_AFINN)
emotion <- convert(sentiment_corpus_dfm_AFINN, to = "data.frame")
net_emotion_AFINN <- emotion$positive-emotion$negative
data <- cbind(data,net_emotion_AFINN)
rm(sentiment_corpus_dfm, sentiment_corpus_dfm_AFINN, sentiment_corpus_tokens,
net_emotion_AFINN, sentiment_corpus, emotion, collocations)
format(as.Date(data$date, format="%d/%m/%Y"),"%Y")
test_data <- data %>% group_by(country) %>% summarise(n = n(), min_rank(n)) %>% filter(min_rank(n) < 10)
ggplot(data, aes(x=date, y=sentiment_EO)) +
geom_line() +
facet_grid(rows = vars(country))
facet_grid(rows = vars(reorder(country, -sentiment_EO)), scales = 'fixed')
# make sure you have the datafiles in a /data/ folder
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
library(stringr)
library(gsubfn)
library(data.table)
library(tidyverse)
library(dplyr)
# set wd to where the source file is
# make sure you have the datafiles in a /data/ folder
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '1950-01-01',]
# drop duplicate EOs
data <- data[!duplicated(data$eo_number),]
# drop not needed columns
data <- subset(data, select = -c(URL, H1, H2, H3))
# add party affiliation by president
data <- data %>%
mutate(
party = case_when(
str_detect(president, "Truman")         ~ "Democrat",
str_detect(president, "Eisenhower")     ~ "Republican",
str_detect(president, "Kennedy")        ~ "Demcrat",
str_detect(president, "Johnson")        ~ "Democrat",
str_detect(president, "Nixon")          ~ "Republican",
str_detect(president, "Ford")           ~ "Republican",
str_detect(president, "Carter")         ~ "Democrat",
str_detect(president, "Reagan")         ~ "Republican",
str_detect(president, "George Bush")    ~ "Republican",
str_detect(president, "Clinton")        ~ "Democrat",
str_detect(president, "George W. Bush") ~ "Republican",
str_detect(president, "Obama")          ~ "Democrat",
str_detect(president, "Trump")          ~ "Republican",
str_detect(president, "Biden")          ~ "Democrat",
)
)
# show new ranges
summary(data)
# rename column to text
data <- data %>% rename(text = body)
# Save dataframe ------------------
fwrite(data, './data/executive_orders_cleaned.csv')
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '1950-01-01',]
# drop duplicate EOs
data <- data[!duplicated(data$eo_number),]
# drop not needed columns
data <- subset(data, select = -c(URL, H1, H2, H3))
# add party affiliation by president
data <- data %>%
mutate(
party = case_when(
str_detect(president, "Truman")         ~ "Democrat",
str_detect(president, "Eisenhower")     ~ "Republican",
str_detect(president, "Kennedy")        ~ "Demcrat",
str_detect(president, "Johnson")        ~ "Democrat",
str_detect(president, "Nixon")          ~ "Republican",
str_detect(president, "Ford")           ~ "Republican",
str_detect(president, "Carter")         ~ "Democrat",
str_detect(president, "Reagan")         ~ "Republican",
str_detect(president, "George Bush")    ~ "Republican",
str_detect(president, "Clinton")        ~ "Democrat",
str_detect(president, "George W. Bush") ~ "Republican",
str_detect(president, "Obama")          ~ "Democrat",
str_detect(president, "Trump")          ~ "Republican",
str_detect(president, "Biden")          ~ "Democrat",
)
)
# show new ranges
summary(data)
# rename column to text
data <- data %>% rename(text = body)
# Save dataframe ------------------
fwrite(data, './data/executive_orders_cleaned.csv')
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '1950-01-01',]
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '01-01-1950',]
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# set wd to where the source file is
# make sure you have the datafiles in a /data/ folder
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
View(data)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
View(data)
sys.setlocale("LC_TIME,"English")
sys.setlocale("LC_TIME","English")
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
View(data)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date
data$date <- str_sub(data$date, start = 6, end = -3)
View(data)
?as.Date
format(Sys.Date(), format = "%Y-%b-%d")
Sys.setlocale("LC_TIME", "E")
Sys.setlocale("LC_TIME", "English")
format(Sys.Date(), format = "%Y-%b-%d")
# extract date (if it doesn't work, use "Sys.setlocale("LC_TIME", "English")"
# to change language of as.date to English)
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date (if it doesn't work, use "Sys.setlocale("LC_TIME", "English")"
# to change language of as.date to English)
data$date <- str_sub(data$date, start = 6, end = -3)
View(data)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '1950-01-01',]
# drop duplicate EOs
data <- data[!duplicated(data$eo_number),]
# drop not needed columns
data <- subset(data, select = -c(URL, H1, H2, H3))
# add party affiliation by president
data <- data %>%
mutate(
party = case_when(
str_detect(president, "Truman")         ~ "Democrat",
str_detect(president, "Eisenhower")     ~ "Republican",
str_detect(president, "Kennedy")        ~ "Demcrat",
str_detect(president, "Johnson")        ~ "Democrat",
str_detect(president, "Nixon")          ~ "Republican",
str_detect(president, "Ford")           ~ "Republican",
str_detect(president, "Carter")         ~ "Democrat",
str_detect(president, "Reagan")         ~ "Republican",
str_detect(president, "George Bush")    ~ "Republican",
str_detect(president, "Clinton")        ~ "Democrat",
str_detect(president, "George W. Bush") ~ "Republican",
str_detect(president, "Obama")          ~ "Democrat",
str_detect(president, "Trump")          ~ "Republican",
str_detect(president, "Biden")          ~ "Democrat",
)
)
# show new ranges
summary(data)
# rename column to text
data <- data %>% rename(text = body)
# Save dataframe ------------------
fwrite(data, './data/executive_orders_cleaned.csv')
library(stringr)
library(gsubfn)
library(data.table)
library(tidyverse)
library(dplyr)
# set wd to where the source file is
# make sure you have the datafiles in a /data/ folder
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#rm(list=ls())
data <- fread('./data/executive_orders.csv')
# inspect
head(data$H1)
head(data$H2)
head(data$H3)
head(data$date)
# extract document type
data$document_type <- substr(data$H1, start = 1, stop = 15)
unique(data$document_type)
# extract executive order number
data$eo_number <- strtoi(substr(data$H1, start = 16, stop = 21))
length(unique(data$eo_number))
# extract title
data$title <- str_sub(data$H1, start = 23)
head(data$title)
tail(data$title)
# extract presidents
data$president <- sub(",.*", "", data$H3)
unique(data$president)
# extract date (if it doesn't work, use "Sys.setlocale("LC_TIME", "English")"
# to change language of as.date to English)
data$date <- str_sub(data$date, start = 6, end = -3)
data$date <- as.Date(data$date, format = "%B %d, %Y")
head(data$date)
# filter all dates after 1950
data <- data[data$date > '1950-01-01',]
# drop duplicate EOs
data <- data[!duplicated(data$eo_number),]
# drop not needed columns
data <- subset(data, select = -c(URL, H1, H2, H3))
# add party affiliation by president
data <- data %>%
mutate(
party = case_when(
str_detect(president, "Truman")         ~ "Democrat",
str_detect(president, "Eisenhower")     ~ "Republican",
str_detect(president, "Kennedy")        ~ "Demcrat",
str_detect(president, "Johnson")        ~ "Democrat",
str_detect(president, "Nixon")          ~ "Republican",
str_detect(president, "Ford")           ~ "Republican",
str_detect(president, "Carter")         ~ "Democrat",
str_detect(president, "Reagan")         ~ "Republican",
str_detect(president, "George Bush")    ~ "Republican",
str_detect(president, "Clinton")        ~ "Democrat",
str_detect(president, "George W. Bush") ~ "Republican",
str_detect(president, "Obama")          ~ "Democrat",
str_detect(president, "Trump")          ~ "Republican",
str_detect(president, "Biden")          ~ "Democrat",
)
)
# show new ranges
summary(data)
# rename column to text
data <- data %>% rename(text = body)
# Save dataframe ------------------
fwrite(data, './data/executive_orders_cleaned.csv')
