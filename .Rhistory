range(nchar(df2$EO_nr), na.rm = TRUE)
range(nchar(df2$date), na.rm = TRUE)
sum(is.na(df2$EO_nr))
sum(is.na(df2$date))
df2$date
df2[nchar(df2$date) = 4]
df2[nchar(df2$date) == 4]
filter(df2, nchar(df2$date) == 4)
sum(is.na(df2$EO_nr) | is.na(df2$date))
sum(is.na(df2$EO_nr) | is.na(df2$date)) #documents missing EO_nr also miss date values
nrow(df2) #
df2 %>% filter(is.na(date))
%>% select(doc_id)
df2 %>% filter(is.na(date)) %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% select(doc_id, -text)
df2 %>% filter(is.na(date)) %>% select(-text)
df2 %>% filter(is.na(date)) %>% select(doc_id, -text)
df3 <- df2 %>% filter(is.na(date)) %>% select(doc_id, -text)
df3$doc_id
rm(df3)
df2 %>% filter(is.na(date)) %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% dataframe() %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% data.frame() %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% vector() %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% c() %>% select(doc_id)
df2 %>% filter(is.na(date)) %>% data.frame() %>% select(doc_id) %>% c()
df2 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c() #creating a vector that contains all the documents with missing values
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
rm(df2)
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c() #disp
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1 %>%
filter(is.na(date)) %>%
data.frame() %>%
select(doc_id) %>%
c()
df1
sum(is.na(df1$EO_nr)) #there are 25 missing EO_nr values
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>%  c()
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id)
df1 %>% filter(is.na(date))
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$EO_nr)) #there are 25 missing EO_nr valu
sum(is.na(df1$date)) #there are 25 missing date values
Sys.setenv(lang = "ENG")
Sys.setlocale("LC_ALL", "English") #not setting this to English will break as.Date()
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
sum(is.na(df1$date)) #there are 25 missing date values
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c()
write.csv(missing_data.csv, here(), df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c())
write.csv(paste0(here(), missing_data.csv),
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c())
write.csv(paste0(here(), "\\missing_data.csv"),
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c())
#displays a vector that contains all the documents with missing values
write.csv(paste0(here(), "\\missing_data.csv"),
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c())
#displays a vector that contains all the documents with missing values
write.csv(paste0(here(), "missing_data.csv"),
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c())
write.csv(df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id) %>% c(),
paste0(here(), "missing_data.csv"))
write.csv(df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id),
paste0(here(), "missing_data.csv"))
write.csv(df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id),
paste0(here(), "\\missing_data.csv"))
write.csv(df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id),
paste0(here(), "\\missing_data.csv"),
row.names = FALSE)
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}Janaury\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}Janaury\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_replace("Janaury", "January") %>% #correcting for typo
as.Date(format = "%B %d, %Y"))
#checking for remaining NAs
sum(is.na(df1$EO_nr))
sum(is.na(df1$date))
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
sum(is.na(df1$EO_nr)) #there are 25 missing EO_nr values
sum(is.na(df1$date)) #there are 25 missing date values
?if
?ifelse
df1 <-for(i in is.na(df1$date)) {df1 %>% mutate(EO_nr =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}Janaury\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}Janaury\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_replace("Janaury", "January") %>% #correcting for typo
as.Date(format = "%B %d, %Y"))
}
sum(is.na(df1$EO_nr))
sum(is.na(df1$date))
sum(is.na(df1$date))
sum(is.na(df1$EO_nr))
regex_pattern <- "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
regex_pattern <- "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 <- df1 %>% mutate(EO_nr =
str_extract(text, regex_pattern) %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, regex_pattern) %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
sum(is.na(df1$date)) #there are 25 missing date values
regex_pattern <- "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
find_EO_dates <- function(x) mutate(x, EO_nr =
str_extract(text, regex_pattern) %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, regex_pattern) %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
df1 <- df1 %>% find_EO_dates()
sum(is.na(df1$date)) #there are 25 missing date values
regex_pattern <- "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 <-for(i in nrow(df1)) {
if (is.na(date)) {
df1 <- df1 %>% find_EO_dates()
}
}
sum(is.na(df1$date)) #there are 25 missing date values
df1$date
df1
df1 <- readtext(here("data"),
docvarsfrom = "filenames")
find_EO_dates <- function(data, regex = "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") mutate(data, EO_nr =
str_extract(text, regex_pattern) %>% str_extract("\\d{4,6}") %>% as.numeric(),
date =
str_extract(text, regex_pattern) %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y"))
df1 <- df1 %>% find_EO_dates()
nrow(df1) #there are 1108 documents
range(nchar(df1$EO_nr), na.rm = TRUE) #all EO_nr have the same length, as they should
sum(is.na(df1$EO_nr)) #there are 25 missing EO_nr values
sum(is.na(df1$date)) #there are 25 missing date values
df1 %>% filter(is.na(date)) %>% data.frame() %>%  select(doc_id)
df1 <-for(i in nrow(df1)) {
if (is.na(date)) {
df1 <- df1 %>% find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
}
}
find_EO_dates <- function(data,
regex = "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") {
mutate(data,
EO_nr =
str_extract(text, regex_pattern) %>%
str_extract("\\d{4,6}") %>%
as.numeric(),
date =
str_extract(text, regex_pattern) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y"))
}
df1 <- readtext(here("data"),
docvarsfrom = "filenames")
#The filename correspond with the federal register doc id. They do not provide additional information, thus no further docvars are specified.
# Some PDFs like 08-62.pdf contain extensive parts with scanned text.
#The code below extractsthe pattern "Executive Order <nr> of <month> <nr>, <year>" from the texts
#It then extracts the EO number and the date of issuance and adds these as variables to a new dataframe df1
find_EO_dates <- function(data,
regex = "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") {
mutate(data,
EO_nr =
str_extract(text, regex_pattern) %>%
str_extract("\\d{4,6}") %>%
as.numeric(),
date =
str_extract(text, regex_pattern) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y"))
}
df1 <- df1 %>% find_EO_dates()
nrow(df1) #there are 1108 documents
range(nchar(df1$EO_nr), na.rm = TRUE) #all EO_nr have the same length, as they should
sum(is.na(df1$EO_nr)) #there are 25 missing EO_nr values
sum(is.na(df1$date)) #th
df1 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
right_join(df1, by = doc_id)
df1 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
right_join(df1, by = text)
df1 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
right_join(df1, by = "text")
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
sum(is.na(df1$date)) #there are 25 missing date values
df1$date
df1
df1 <- df1 %>% find_EO_dates()
sum(is.na(df1$date))
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2
df1
df1 <- readtext(here("data"),
docvarsfrom = "filenames")
#The filename correspond with the federal register doc id. They do not provide additional information, thus no further docvars are specified.
# Some PDFs like 08-62.pdf contain extensive parts with scanned text.
#The code below extractsthe pattern "Executive Order <nr> of <month> <nr>, <year>" from the texts
#It then extracts the EO number and the date of issuance and adds these as variables to a new dataframe df1
df1 <- df1 %>% find_EO_dates()
df3 <- df1
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2
df2$date
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2
df2$date
?str_extract()
str_extract("test Order of December 2, 2016", "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
filter(df1, doc_id == "2016-29494.pdf")
filter(df1, doc_id == "2016-29494.pdf") %>% select(text)
filter(df1, doc_id == "2016-29494.pdf") %>% select(text)
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% View()
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% head()
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4})
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4})
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
sum(is.na(df1$date)) #there are 25 missing date values
df1$date
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
sum(is.na(df1$date)) #there are 25 missing date values
find_EO_dates <- function(data,
regex = "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") {
mutate(data,
#EO_nr =
#   str_extract(text, regex_pattern) %>%
#  str_extract("\\d{4,6}") %>%
# as.numeric(),
date =
str_extract(text, regex_pattern) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y"))
}
find_EO_dates <- function(data,
regex = "Executive\\s{1}Order\\s{1}\\d{4,6}\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") {
mutate(data,
#EO_nr =
#   str_extract(text, regex_pattern) %>%
#  str_extract("\\d{4,6}") %>%
# as.numeric(),
date =
str_extract(text, regex_pattern) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y"))
}
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
sum(is.na(df1$date)) #there are 25 missing date values
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
Sys.setlocale("LC_ALL", "English") #not setting this to English will break as.Date()
df2 <- df1 %>%
filter(is.na(date)) %>%
find_EO_dates(regex = "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}")
sum(is.na(df1$date)) #there ar
filter(df1, doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
df1 %>% filter(is.na(date)) filter(doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
df1 %>% filter(is.na(date)) filter(doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
df1 %>% filter(is.na(date)) %>% filter(doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
new_regex <- "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract(new_regex) %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract(new_regex) %>%
as.Date(format = "%B %d, %Y")
"Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}" == "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 %>% filter(is.na(date)) %>% filter(doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
df1 %>% filter(is.na(date)) %>% filter(doc_id == "2016-29494.pdf") %>% select(text) %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>% as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract("Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
new_regex <- "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
"(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}" == "(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
"(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}" == "(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
"(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}" == "(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df1 %>%
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
df1 %>% ## meanwhile, picking a single document like this somehow works, the date is correctly extracted. I don't know why  ----
filter(is.na(date)) %>%
filter(doc_id == "2016-29494.pdf") %>%
select(text) %>%
str_extract(new_regex) %>%
str_extract("(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}") %>%
as.Date(format = "%B %d, %Y")
new_regex <- "Order\\s{1}of\\s{1}(January|February|March|April|May|June|July|August|September|October|November|December)\\s{1}\\d{1,2},\\s{1}\\d{4}"
df2 <- df1 %>%t ## I don't understand why this code is not working! all the dates remain NA ----
filter(is.na(date)) %>%
find_EO_dates(regex = new_regex)
sum(is.na(df1$date)) # there are still 25 missing date values, meaning the code above failed
df2 <- df1 %>% ## I don't understand why this code is not working! all the dates remain NA ----
filter(is.na(date)) %>%
find_EO_dates(regex = new_regex)
sum(is.na(df1$date)) # there are still 25 missing date values, meaning the code above failed
df2 <- df1 %>% ## I don't understand why this code is not working! all the dates remain NA ----
filter(is.na(date)) %>%
find_EO_dates(regex = new_regex)
sum(is.na(df1$date)) # there are still 25 missing date values, meaning the code above failed
filter(df)
rm(df3)
df2 <- df1 %>% ## I don't understand why this code is not working! all the dates remain NA ----
filter(is.na(date)) %>%
find_EO_dates(regex = new_regex)
sum(is.na(df1$date)) # there are still 25 missing date values, meaning the code above failed
